<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mixed Signal Hardware Design</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header id="header">
        <h1>Designing a Mixed Signal Printed Circuit Board - Part 3 (Microcontroller Unit)</h1>
        <p>January 8, 2024</p>
    </header>

    <section id="main">
        <h2>Microcontroller Integration (STM32)</h2>
        <img src="https://raw.githubusercontent.com/moehambouta/Mixed-Signal-PCB/website/assets/mcu.png" alt="MCU Schematic">
        <p>
            The centerpiece of our PCB is the STM32F1 series microcontroller, selected for its balance of processing power, peripheral availability, and energy efficiency. Critical to our application, this MCU provides the necessary computational capabilities while maintaining a low power footprint, essential for our bus-powered design.
        </p>
        <p>
            The MCU is powered through a network of decoupling capacitors (C200-C207) that serve to filter noise across a spectrum of frequencies. These capacitors ensure that the power supply to the MCU is clean, which is crucial for maintaining the integrity of the analog signals being processed. The capacitors are placed in close proximity to the MCU to minimize inductive loops and provide immediate charge reservoirs for transient current demands.
        </p>
        <p>
            The 16 MHz crystal oscillator, along with its loading capacitors (C208, C209), provides a stable clock source for the MCU. This frequency was chosen for its commonality and the ease of deriving both high-speed and low-power peripheral clocks as needed for various functions of the microcontroller.
        </p>
        <p>
            The MCU's I/O pins are meticulously assigned specific roles. The USB data lines (PA11, PA12) are directly connected to the MCU, facilitating the USB 2.0 communication. SPI lines (including SPI2_NSS, SPI2_SCK, SPI2_MISO, SPI2_MOSI) are interfaced with external peripherals for high-speed data transfer. The analog pins (such as PA0 for ADC and PA4 for DAC) are dedicated to analog signal tasks, reflecting the mixed-signal nature of the board.
        </p>
        <p>
            The SWD interface (SWDIO, SWCLK) is allocated for programming and debugging the MCU. The NRST pin is pulled high through a resistor (R200), but can be driven low for a system reset, providing a means for manual or programmed reset sequences.
        </p>
        <img src="https://raw.githubusercontent.com/moehambouta/Mixed-Signal-PCB/website/assets/pinout.png" alt="MCU Pin Out">
        <p>
            The STM32CubeIDE was utilized for the initial configuration and pin planning of the MCU. This integrated development environment provides a user-friendly graphical tool to assign pin functions, set up peripheral configurations, and generate initialization code, streamlining the development process. The IDE's pinout planning tool was especially useful in visualizing the complex pin assignments and ensuring that all peripherals were correctly configured without conflict.
        </p>

        <h2>USB Type-C Interface</h2>
        <img src="https://raw.githubusercontent.com/moehambouta/Mixed-Signal-PCB/website/assets/usb.png" alt="USB Type-C Schematic">
        <p>
            The USB Type-C interface on this PCB is designed with a focus on functionality and efficiency for low-frequency signal applications. In the context of USB 2.0 standards, our design aims to optimize data transfer rates within the audio band, negating the necessity for the more complex USB 3.x infrastructure.
        </p>
        <p>
            The USB-C connector (J201) facilitates power delivery and data transmission, leveraging the versatility of a reversible connection. The VBUS line, which supplies power to the device, is directly connected to the USB-C receptacle, ensuring a stable power source for the system. To maintain signal integrity, USB data lines (D+ and D-) are routed through a series of passive components that include ESD protection diodes (U201) and pull-up resistors (R205, R206). These protection diodes safeguard the circuit from electrostatic discharge events, which are critical for the longevity and reliability of the USB interface.
        </p>
        <p>
            A common-mode choke (FL201) is introduced in the signal path to filter out common-mode noise, thus enhancing the EMC performance of the device. This is particularly important in mixed-signal applications where digital noise can adversely affect analog signal quality. The chosen common-mode choke presents an impedance of 90Î©, which is a suitable value to mitigate potential interference without compromising the USB 2.0 signal integrity.
        </p>
        <p>
            The USB 2.0 data lines are also equipped with a pull-up resistor network, which is crucial for establishing the presence of a high-speed device when connecting to a host. This configuration adheres to the USB 2.0 specification and ensures proper enumeration and communication with the USB host controller.
        </p>

        <p>
            <span>Next post: </span>
            <a href="dsp.html">Signal Processing Capabilities</a>
        </p>
    </section>
    </section>

    <script src="script.js"></script>
</body>
</html>
